<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Arcuz Mobile Fix</title>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
    <style>
        * { box-sizing: border-box; touch-action: none; -webkit-user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        #game-container { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        #ruffle-player { width: 100%; height: 100%; }

        /* Controls */
        .ui-layer { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; pointer-events: none; z-index: 999; }
        .btn { 
            width: 60px; height: 60px; background: rgba(255,255,255,0.2); 
            border: 2px solid #fff; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; color: #fff; 
            pointer-events: auto; font-weight: bold;
        }
        .btn:active { background: rgba(255,255,255,0.6); }
        .dpad { display: grid; grid-template-columns: repeat(3, 65px); gap: 5px; }
        .actions { display: grid; grid-template-columns: repeat(2, 70px); gap: 10px; align-items: end; }
        
        #start-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index: 10000; display: flex; align-items: center; justify-content: center; }
        #start-btn { padding: 20px 40px; background: #27ae60; color: white; border: none; border-radius: 10px; font-size: 20px; }
    </style>
</head>
<body>

<div id="start-overlay">
    <button id="start-btn">TAP TO LOAD CONTROLS</button>
</div>

<div id="game-container">
    <div id="ruffle-player"></div>
</div>

<div class="ui-layer">
    <div class="dpad">
        <div></div><div class="btn" data-k="w">W</div><div></div>
        <div class="btn" data-k="a">A</div><div class="btn" data-k="s">S</div><div class="btn" data-k="d">D</div>
    </div>
    <div class="actions">
        <div class="btn" style="background:rgba(255,0,0,0.5)" data-k="j">J</div>
        <div class="btn" style="background:rgba(0,0,255,0.5)" data-k="k">K</div>
        <div class="btn" data-k="1">1</div>
        <div class="btn" data-k="2">2</div>
    </div>
</div>

<script>
    const ruffle = window.RufflePlayer.newest();
    const player = ruffle.createPlayer();
    document.getElementById("ruffle-player").appendChild(player);
    player.load("Arcuz.swf");

    const keyMap = { 
        'w': 87, 'a': 65, 's': 83, 'd': 68, 
        'j': 74, 'k': 75, '1': 49, '2': 50 
    };

    function triggerKey(keyChar, type) {
        const code = keyMap[keyChar];
        // Create the event
        const event = new KeyboardEvent(type, {
            key: keyChar,
            code: isNaN(keyChar) ? "Key" + keyChar.toUpperCase() : "Digit" + keyChar,
            keyCode: code,
            which: code,
            bubbles: true,
            cancelable: true
        });

        // Focus the player and dispatch to BOTH player and window
        player.focus();
        player.dispatchEvent(event);
        window.dispatchEvent(event);
    }

    // Handle button touches
    document.querySelectorAll('.btn').forEach(btn => {
        const k = btn.getAttribute('data-k');
        
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            triggerKey(k, 'keydown');
        });

        btn.addEventListener('touchend', (e) => {
            e.preventDefault();
            triggerKey(k, 'keyup');
        });
    });

    // Start Button Fixes Audio and Fullscreen
    document.getElementById('start-btn').addEventListener('click', () => {
        document.getElementById('start-overlay').style.display = 'none';
        if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
        player.focus();
    });
</script>

</body>
</html>
