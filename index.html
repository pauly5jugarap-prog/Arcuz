<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Arcuz Mobile Fix</title>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
    <style>
        * { box-sizing: border-box; touch-action: none; -webkit-user-select: none; user-select: none; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; position: fixed; }
        #ruffle-player { width: 100%; height: 100%; position: absolute; top: 0; left: 0; }

        /* Controls */
        .ui-layer { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; pointer-events: none; z-index: 999; }
        .btn { 
            width: 65px; height: 65px; background: rgba(255,255,255,0.2); 
            border: 2px solid #fff; border-radius: 50%; display: flex; 
            align-items: center; justify-content: center; color: #fff; 
            pointer-events: auto; font-weight: bold; font-size: 20px;
        }
        .btn:active { background: rgba(255,255,255,0.6); transform: scale(1.1); }
        .dpad { display: grid; grid-template-columns: repeat(3, 65px); gap: 5px; }
        .actions { display: flex; gap: 15px; align-items: flex-end; }
        
        #overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #111; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; }
        #start-btn { padding: 20px 40px; background: #e74c3c; color: white; border: none; border-radius: 10px; font-size: 24px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="overlay">
    <h2>Arcuz: Behind the Dark</h2>
    <button id="start-btn">PLAY NOW</button>
</div>

<div id="ruffle-player"></div>

<div class="ui-layer">
    <div class="dpad">
        <div></div><div class="btn" data-k="w">W</div><div></div>
        <div class="btn" data-k="a">A</div><div class="btn" data-k="s">S</div><div class="btn" data-k="d">D</div>
    </div>
    <div class="actions">
        <div class="btn" style="background:rgba(255,0,0,0.5)" data-k="j">J</div>
        <div class="btn" style="background:rgba(0,0,255,0.5)" data-k="k">K</div>
    </div>
</div>

<script>
    const ruffle = window.RufflePlayer.newest();
    const player = ruffle.createPlayer();
    document.getElementById("ruffle-player").appendChild(player);
    player.load("Arcuz.swf");

    // Key map for Flash
    const keyMap = { 
        'w': 87, 'a': 65, 's': 83, 'd': 68, 'j': 74, 'k': 75 
    };

    function triggerKey(keyChar, type) {
        const code = keyMap[keyChar];
        const eventData = {
            key: keyChar,
            code: "Key" + keyChar.toUpperCase(),
            keyCode: code,
            which: code,
            bubbles: true,
            cancelable: true
        };

        const e = new KeyboardEvent(type, eventData);

        // SEND TO ALL THREE to ensure the Flash bridge catches it
        window.dispatchEvent(e);
        document.dispatchEvent(e);
        player.dispatchEvent(e);
    }

    // Button Logic
    document.querySelectorAll('.btn').forEach(btn => {
        const k = btn.getAttribute('data-k');
        
        btn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            triggerKey(k, 'keydown');
        });

        btn.addEventListener('touchend', (e) => {
            e.preventDefault();
            triggerKey(k, 'keyup');
        });
    });

    // Start Button: Fullscreen + Audio Unlock + Focus
    document.getElementById('start-btn').addEventListener('click', () => {
        document.getElementById('overlay').style.display = 'none';
        
        // Try to enter fullscreen
        if (document.documentElement.requestFullscreen) {
            document.documentElement.requestFullscreen();
        }

        // Essential: Give the game focus
        setTimeout(() => {
            player.focus();
        }, 100);
    });
</script>

</body>
</html>
