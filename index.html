<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arcuz</title>
    <script src="https://unpkg.com/@ruffle-rs/ruffle"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; touch-action: none; }
        #ruffle { width: 100vw; height: 100vh; }
        
        /* Layout for Controls */
        .controls { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; pointer-events: none; }
        .btn { 
            width: 65px; height: 65px; background: rgba(255,255,255,0.15); 
            border: 2px solid rgba(255,255,255,0.8); border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            color: #fff; pointer-events: auto; user-select: none; font-weight: bold;
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active { background: rgba(255,255,255,0.5); transform: scale(1.1); }
        
        .dpad { display: grid; grid-template-columns: repeat(3, 70px); gap: 5px; }
        .actions { display: flex; gap: 20px; align-items: flex-end; }
        .action-red { background: rgba(255,0,0,0.4) !important; width: 80px; height: 80px; }
        .action-blue { background: rgba(0,0,255,0.4) !important; width: 80px; height: 80px; }
    </style>
</head>
<body>
    <div id="ruffle"></div>

    <div class="controls">
        <div class="dpad">
            <div></div><div class="btn" data-key="w">W</div><div></div>
            <div class="btn" data-key="a">A</div><div class="btn" data-key="s">S</div><div class="btn" data-key="d">D</div>
        </div>

        <div class="actions">
            <div class="btn action-red" data-key="j">ATK (J)</div>
            <div class="btn action-blue" data-key="k">JMP (K)</div>
        </div>
    </div>

    <script>
        // 1. Load Ruffle
        const ruffle = window.RufflePlayer.newest();
        const player = ruffle.createPlayer();
        document.getElementById("ruffle").appendChild(player);
        player.load("Arcuz.swf");

        // 2. The Secret Sauce: Keyboard Simulation
        function sendKeyEvent(key, type) {
            const keyCodeMap = { 'w':87, 'a':65, 's':83, 'd':68, 'j':74, 'k':75 };
            const code = keyCodeMap[key];
            
            const event = new KeyboardEvent(type, {
                key: key,
                keyCode: code,
                which: code,
                code: "Key" + key.toUpperCase(),
                bubbles: true,
                cancelable: true
            });
            
            // Dispatch to both window and the player specifically
            window.dispatchEvent(event);
            player.dispatchEvent(event);
        }

        // 3. Attach Events to Buttons
        document.querySelectorAll('.btn').forEach(button => {
            const key = button.getAttribute('data-key');

            // Handle Touch
            button.addEventListener('touchstart', (e) => {
                e.preventDefault();
                sendKeyEvent(key, 'keydown');
            });
            button.addEventListener('touchend', (e) => {
                e.preventDefault();
                sendKeyEvent(key, 'keyup');
            });

            // Handle Mouse (for testing on PC)
            button.addEventListener('mousedown', () => sendKeyEvent(key, 'keydown'));
            button.addEventListener('mouseup', () => sendKeyEvent(key, 'keyup'));
        });

        // Prevent zooming when tapping fast
        document.addEventListener('touchstart', (e) => {
            if (e.touches.length > 1) e.preventDefault();
        }, { passive: false });
    </script>
</body>
</html>
